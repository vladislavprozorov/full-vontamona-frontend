# Quiz Architecture - Visual Flow

## 📊 Диаграмма зависимостей

```
┌─────────────────────────────────────────────────────────────┐
│                        quiz-form.tsx                        │
│                   (Компонент-сборщик)                       │
│                        65 строк                             │
└────────────────────┬────────────────────────────────────────┘
                     │
         ┌───────────┼───────────┐
         │           │           │
         ▼           ▼           ▼
┌─────────────┐ ┌─────────┐ ┌──────────────┐
│ quiz.hooks  │ │ Layout  │ │ SuccessScreen│
│   (logic)   │ │  (UI)   │ │    (UI)      │
└──────┬──────┘ └────┬────┘ └──────────────┘
       │             │
       │        ┌────┴────┐
       │        │  steps/ │
       │        └────┬────┘
       │             │
       ▼             ▼
┌────────────┐  ┌──────────┐
│ constants  │  │ DatesStep│
│  OPTIONS   │  │BudgetStep│
│QUIZ_STEPS  │  │   ...    │
└─────┬──────┘  └────┬─────┘
      │              │
      ▼              ▼
┌──────────┐   ┌──────────┐
│  types   │◄──│  schema  │
│ QuizStep │   │   Zod    │
└──────────┘   └──────────┘
```

## 🔄 Data Flow (Поток данных)

```
User Action
    │
    ▼
┌─────────────────────────────┐
│    Step Component           │
│  (DatesStep, BudgetStep)    │  ← Чистый UI компонент
└─────────────┬───────────────┘
              │ onSelect(value)
              ▼
┌─────────────────────────────┐
│       useQuiz Hook          │
│  handleOptionSelect()       │  ← Бизнес-логика
│  setFormData()              │
│  goToNextStep()             │
└─────────────┬───────────────┘
              │ update state
              ▼
┌─────────────────────────────┐
│      QuizForm (main)        │
│  Re-render with new step    │  ← Оркестратор
└─────────────┬───────────────┘
              │ render
              ▼
┌─────────────────────────────┐
│       QuizLayout            │
│   + Next Step Component     │  ← Презентация
└─────────────────────────────┘
```

## 🎯 Что где живёт

### 📝 Данные (Data)

```
quiz.types.ts        ← Что это такое
quiz.constants.ts    ← Статичные значения
quiz.schema.ts       ← Правила валидации
```

### 🧠 Логика (Logic)

```
quiz.hooks.ts        ← Вся бизнес-логика
  └─ useQuiz()
      ├─ state management
      ├─ navigation
      └─ API calls
```

### 🎨 UI (Presentation)

```
QuizLayout.tsx       ← Каркас (header/body/footer)
SuccessScreen.tsx    ← Финальный экран
steps/               ← Отдельные шаги
  ├─ DatesStep.tsx
  ├─ BudgetStep.tsx
  └─ ...
```

### 🎯 Сборка (Composition)

```
quiz-form.tsx        ← Компонент-оркестратор
  ├─ useQuiz()       (логика)
  ├─ stepsMap        (маппинг)
  └─ <QuizLayout>    (рендер)
```

## 📦 Принцип работы

1. **User кликает** на опцию → вызывается `onSelect(value)`
2. **Step** передаёт значение в **hook** → `handleOptionSelect('dates', value)`
3. **Hook** обновляет `formData` и вызывает `goToNextStep()`
4. **QuizForm** получает новый `currentStep` из хука
5. **stepsMap** выбирает нужный компонент по ключу
6. **QuizLayout** рендерит новый шаг с анимацией

## ✅ Преимущества такой архитектуры

```
┌──────────────────────────────────────────────────────────┐
│  Старая архитектура (quiz-form-old.tsx)                 │
│  ────────────────────────────────────────────────────    │
│  ❌ 547 строк в одном файле                              │
│  ❌ Логика + UI смешаны                                  │
│  ❌ Сложно найти нужный шаг                              │
│  ❌ Тяжело добавлять новые фичи                          │
│  ❌ Невозможно тестировать по частям                     │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  Новая архитектура (чистая)                              │
│  ────────────────────────────────────────────────────    │
│  ✅ 9 файлов по 30-100 строк                             │
│  ✅ Логика отделена от UI                                │
│  ✅ Каждый шаг в своём файле                             │
│  ✅ Добавить шаг = скопировать шаблон                    │
│  ✅ Легко покрыть тестами                                │
│  ✅ IDE автокомплит работает идеально                    │
└──────────────────────────────────────────────────────────┘
```

## 🚀 Time to Value

### Добавить новый шаг

- **Старая версия**: 30-40 минут, найти место, не сломать логику
- **Новая версия**: **5 минут**, скопировать шаблон из EXAMPLE_NEW_STEP.ts

### Изменить UX одного шага

- **Старая версия**: 15 минут, найти код в 547 строках
- **Новая версия**: **2 минуты**, открыть `steps/DatesStep.tsx`

### Покрыть тестами

- **Старая версия**: невозможно, всё связано
- **Новая версия**: **легко**, каждая часть независима

## 🎓 Пример использования

```tsx
// Вместо копипасты 100 строк JSX:
const stepsMap = {
  dates: <DatesStep onSelect={(v) => handleOptionSelect("dates", v)} />,
};

// Все шаги единообразны, понятны, переиспользуемы
```

---

**Итог**: Код стал чище, понятнее, масштабируемее. Любой разработчик может подхватить проект за 10 минут.
